
==================== ApiController ====================
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.Logging;
using Swashbuckle.AspNetCore.Annotations;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }};
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Shared;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Create;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetById;
{{~ for useCase in UseCases ~}}
{{~ if useCase.Name != "Create" && useCase.Name != "GetById" && useCase.Name != "GetAll" ~}}
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.{{ useCase.Name }};
{{~ end ~}}
{{~ end ~}}
using {{ WebApiProject.Namespace }}.Models.{{ AggregateRoot.Name.Plural }}.Shared;
using {{ WebApiProject.Namespace }}.Models.{{ AggregateRoot.Name.Plural }}.Create;
using {{ WebApiProject.Namespace }}.Models.{{ AggregateRoot.Name.Plural }}.GetAll;
using LiteBus.Commands.Abstractions;
using LiteBus.Queries.Abstractions;

namespace {{ WebApiProject.Namespace }}.Controllers;

/// <summary>
/// Controller for managing {{ AggregateRoot.Name.Plural }}.
/// </summary>
[ApiController]
[Route("api/[controller]")]
[Produces("application/json")]
public class {{ AggregateRoot.Name.Plural }}Controller : ControllerBase
{
    private readonly ICommandMediator _commandMediator;
    private readonly IQueryMediator _queryMediator;
    private readonly ILogger<{{ AggregateRoot.Name.Plural }}Controller> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="{{ AggregateRoot.Name.Plural }}Controller"/> class.
    /// </summary>
    /// <param name="commandMediator">The command mediator.</param>
    /// <param name="queryMediator">The query mediator.</param>
    /// <param name="logger">The logger.</param>
    public {{ AggregateRoot.Name.Plural }}Controller(ICommandMediator commandMediator, IQueryMediator queryMediator, ILogger<{{ AggregateRoot.Name.Plural }}Controller> logger)
    {
        _commandMediator = commandMediator;
        _queryMediator = queryMediator;
        _logger = logger;
    }

    /// <summary>
    /// Creates a new {{ AggregateRoot.Name }}.
    /// </summary>
    /// <param name="request">The creation request.</param>
    /// <param name="cancellationToken">The cancellation token.</param>
    /// <returns>The created {{ AggregateRoot.Name }} ID.</returns>
    [HttpPost]
    [ProducesResponseType(typeof(Create{{ AggregateRoot.Name }}Response), StatusCodes.Status201Created)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [SwaggerOperation(Summary = "Create a new {{ AggregateRoot.Name }}", Description = "Creates a new {{ AggregateRoot.Name }} with the provided details.")]
    public async Task<IActionResult> CreateAsync([FromBody] Create{{ AggregateRoot.Name }}Request request, CancellationToken cancellationToken)
    {
        _logger.LogInformation("Creating new {{ AggregateRoot.Name }}");

        var command = new Create{{ AggregateRoot.Name }}Command
        {
            {{~ for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
            {{~ if parameter.IsComplex ~}}
            {{ parameter.Name.PascalCase }} = new {{ parameter.Name.PascalCase }}CommandModel
            {
                {{~ for nestedParameter in parameter.NestedParameters ~}}
                {{ nestedParameter.Name.PascalCase }} = request.{{ parameter.Name.PascalCase }}.{{ nestedParameter.Name.PascalCase }},
                {{~ end ~}}
            },
            {{~ else ~}}
            {{ parameter.Name.PascalCase }} = request.{{ parameter.Name.PascalCase }},
            {{~ end ~}}
            {{~ end ~}}
        };

        var result = await _commandMediator.SendAsync(command, cancellationToken);

        var response = new Create{{ AggregateRoot.Name }}Response
        {
            Id = result.Id
        };

        _logger.LogInformation("Created new {{ AggregateRoot.Name }} with ID: {Id}", response.Id);

        return CreatedAtAction(nameof(GetByIdAsync), new { id = response.Id }, response);
    }

    /// <summary>
    /// Retrieves a specific {{ AggregateRoot.Name }} by its identifier.
    /// </summary>
    /// <param name="id">The {{ AggregateRoot.Name }} identifier.</param>
    /// <param name="cancellationToken">The cancellation token.</param>
    /// <returns>The requested {{ AggregateRoot.Name }}.</returns>
    [HttpGet("{id}")]
    [ProducesResponseType(typeof({{ AggregateRoot.Name }}ResponseModel), StatusCodes.Status200OK)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [SwaggerOperation(Summary = "Get a specific {{ AggregateRoot.Name }}", Description = "Retrieves a {{ AggregateRoot.Name }} by its unique identifier.")]
    public async Task<ActionResult<{{ AggregateRoot.Name }}ResponseModel>> GetByIdAsync([FromRoute] {{ AggregateRoot.IdType }} id, CancellationToken cancellationToken)
    {
        _logger.LogInformation("Retrieving {{ AggregateRoot.Name }} with ID: {Id}", id);
        
        var query = new Get{{ AggregateRoot.Name }}ByIdQuery { Id = id };
        
        var result = await _queryMediator.QueryAsync(query, cancellationToken);

        var responseModel = MapToResponseModel(result);
        
        _logger.LogInformation("Retrieved {{ AggregateRoot.Name }} with ID: {Id}", id);
        
        return Ok(responseModel);
    }

    /// <summary>
    /// Retrieves all {{ AggregateRoot.Name.Plural }}.
    /// </summary>
    /// <param name="cancellationToken">The cancellation token.</param>
    /// <returns>A collection of {{ AggregateRoot.Name.Plural }}.</returns>
    [HttpGet]
    [ProducesResponseType(typeof(IAsyncEnumerable<{{ AggregateRoot.Name }}ResponseModel>), StatusCodes.Status200OK)]
    [SwaggerOperation(Summary = "Get all {{ AggregateRoot.Name.Plural }}", Description = "Retrieves all {{ AggregateRoot.Name.Plural }}.")]
    public IAsyncEnumerable<{{ AggregateRoot.Name }}ResponseModel> GetAllAsync(CancellationToken cancellationToken)
    {
        _logger.LogInformation("Retrieving all {{ AggregateRoot.Name.Plural }}");
        
        var query = new GetAll{{ AggregateRoot.Name.Plural }}Query();

        var results = _queryMediator.StreamAsync(query, cancellationToken);
        var responseModels = results.Select(MapToResponseModel);
        
        return Ok(responseModels);
    }

    {{~ for useCase in UseCases ~}}
    {{~ if useCase.Name != "Create" && useCase.Name != "GetById" && useCase.Name != "GetAll" ~}}
    /// <summary>
    /// {{ useCase.Name.Humanize }} a {{ AggregateRoot.Name }}.
    /// </summary>
    /// <param name="id">The {{ AggregateRoot.Name }} identifier.</param>
    /// <param name="request">The {{ useCase.Name.Humanize }} request.</param>
    /// <param name="cancellationToken">The cancellation token.</param>
    /// <returns>The result of the {{ useCase.Name.Humanize }} operation.</returns>
    [HttpPatch("{id}/{{ useCase.Name.Kebabcase }}")]
    [ProducesResponseType(StatusCodes.Status204NoContent)]
    [ProducesResponseType(StatusCodes.Status400BadRequest)]
    [ProducesResponseType(StatusCodes.Status404NotFound)]
    [SwaggerOperation(Summary = "{{ useCase.Name.Humanize }} a {{ AggregateRoot.Name }}", Description = "{{ useCase.Name.Humanize }} a {{ AggregateRoot.Name }} with the provided details.")]
    public async Task<IActionResult> {{ useCase.Name }}Async([FromRoute] {{ AggregateRoot.IdType }} id, [FromBody] {{ useCase.Name }}{{ AggregateRoot.Name }}Request request, CancellationToken cancellationToken)
    {
        _logger.LogInformation("{{ useCase.Name.Humanize }} {{ AggregateRoot.Name }} with ID: {Id}", id);

        var command = new {{ useCase.Name }}{{ AggregateRoot.Name }}Command
        {
            Id = id,
            {{~ for parameter in useCase.Parameters ~}}
            {{~ if parameter.IsComplex ~}}
            {{ parameter.Name.PascalCase }} = new {{ parameter.Name.PascalCase }}CommandModel
            {
                {{~ for nestedParameter in parameter.NestedParameters ~}}
                {{ nestedParameter.Name.PascalCase }} = request.{{ parameter.Name.PascalCase }}.{{ nestedParameter.Name.PascalCase }},
                {{~ end ~}}
            },
            {{~ else ~}}
            {{ parameter.Name.PascalCase }} = request.{{ parameter.Name.PascalCase }},
            {{~ end ~}}
            {{~ end ~}}
        };

        await _commandMediator.SendAsync(command, cancellationToken);
        _logger.LogInformation("{{ useCase.Name.Humanize }} completed for {{ AggregateRoot.Name }} with ID: {Id}", id);
        
        return NoContent();
    }
    {{~ end ~}}
    {{~ end ~}}

    private static {{ AggregateRoot.Name }}ResponseModel MapToResponseModel({{ AggregateRoot.Name }}QueryResult result)
    {
        return new {{ AggregateRoot.Name }}ResponseModel
        {
            {{~ for property in AggregateRoot.Properties ~}}
            {{~ if property.IsComplex ~}}
            {{ property.Name.PascalCase }} = new {{ property.Name.PascalCase }}ResponseModel
            {
                {{~ for nestedProperty in property.NestedProperties ~}}
                {{ nestedProperty.Name.PascalCase }} = result.{{ property.Name.PascalCase }}.{{ nestedProperty.Name.PascalCase }},
                {{~ end ~}}
            },
            {{~ else ~}}
            {{ property.Name.PascalCase }} = result.{{ property.Name.PascalCase }},
            {{~ end ~}}
            {{~ end ~}}
        };
    }
}

==================== CreateCommand ====================
using LiteBus.Commands.Abstractions;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Create;

/// <summary>
/// Represents a command to create a new {{ AggregateRoot.Name }}.
/// </summary>
public sealed class Create{{ AggregateRoot.Name }}Command : ICommand<Create{{ AggregateRoot.Name }}CommandResult>
{
{{~ for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
    /// <summary>
    /// Gets or initializes the {{ parameter.Name.Humanize }}.
    /// </summary>
    public {{ if parameter.IsRequired }}required {{ end }}{{ if parameter.IsComplex }}{{ parameter.Name.PascalCase }}CommandModel{{ else }}{{ parameter.Type }}{{ end }} {{ parameter.Name.PascalCase }} { get; init; }
{{~ end ~}}
}

{{~ for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
{{~ if parameter.IsComplex ~}}
/// <summary>
/// Represents the {{ parameter.Name.Humanize }} model for creating a {{ AggregateRoot.Name }}.
/// </summary>
public sealed class {{ parameter.Name.PascalCase }}CommandModel
{
    {{~ for nestedParameter in parameter.NestedParameters ~}}
    /// <summary>
    /// Gets or initializes the {{ nestedParameter.Name.Humanize }}.
    /// </summary>
    public {{ if nestedParameter.IsRequired }}required {{ end }}{{ nestedParameter.Type }} {{ nestedParameter.Name.PascalCase }} { get; init; }
    {{~ end ~}}
}

{{~ end ~}}
{{~ end ~}}

==================== CreateCommandHandler ====================
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Create;
using {{ DomainProject.Namespace }};
using {{ DomainProject.Namespace }}.{{ AggregateRoot.Name.Plural }};
using LiteBus.Commands.Abstractions;
using Microsoft.Extensions.Logging;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Create;

/// <summary>
/// Handles the creation of a new {{ AggregateRoot.Name }}.
/// </summary>
public class Create{{ AggregateRoot.Name }}CommandHandler : ICommandHandler<Create{{ AggregateRoot.Name }}Command, Create{{ AggregateRoot.Name }}CommandResult>
{
{{~if Options.UseGenericRepository ~}}
    private readonly IRepository<{{ AggregateRoot.Name }}> _repository;
{{~else~}}
    private readonly I{{ AggregateRoot.Name }}Repository _repository;
{{~end~}}
    private readonly ILogger<Create{{ AggregateRoot.Name }}CommandHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="Create{{ AggregateRoot.Name }}CommandHandler"/> class.
    /// </summary>
{{~if Options.UseGenericRepository ~}}
    public Create{{ AggregateRoot.Name }}CommandHandler(IRepository<{{ AggregateRoot.Name }}> repository, ILogger<Create{{ AggregateRoot.Name }}CommandHandler> logger)
{{~else~}}
    public Create{{ AggregateRoot.Name }}CommandHandler(I{{ AggregateRoot.Name }}Repository repository, ILogger<Create{{ AggregateRoot.Name }}CommandHandler> logger)
{{~end~}}
    {
        _repository = repository;
        _logger = logger;
    }

    /// <summary>
    /// Handles the command to create a new {{ AggregateRoot.Name }}.
    /// </summary>
    /// <param name="command">The command to create a new {{ AggregateRoot.Name }}.</param>
    /// <param name="cancellationToken">The cancellation token.</param>
    /// <returns>A <see cref="Create{{ AggregateRoot.Name }}CommandResult"/> containing the Id of the newly created {{ AggregateRoot.Name }}.</returns>
    public async Task<Create{{ AggregateRoot.Name }}CommandResult> HandleAsync(Create{{ AggregateRoot.Name }}Command command, CancellationToken cancellationToken = default)
    {
        _logger.LogInformation("Creating new {{ AggregateRoot.Name }}");

        {{ AggregateRoot.Name }} {{ AggregateRoot.Name.CamelCase }};

{{~if AggregateRoot.CreateUseCase.Mechanism == 'InitProperties' ~}}
        {{ AggregateRoot.Name.CamelCase }} = new {{ AggregateRoot.Name }}
        {
    {{~for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
        {{~if parameter.IsComplex ~}}
            {{ parameter.Name.PascalCase }} = new {{ parameter.Type }}
            {
            {{~for nestedParameter in parameter.NestedParameters ~}}
                {{ nestedParameter.Name.PascalCase }} = command.{{ parameter.Name.PascalCase }}.{{ nestedParameter.Name.PascalCase }},
            {{~end~}}
            },
        {{~else~}}
            {{ parameter.Name.PascalCase }} = command.{{ parameter.Name.PascalCase }},
        {{~end~}}
    {{~end~}}
        };
{{~end~}}
{{~if AggregateRoot.CreateUseCase.Mechanism == 'StaticCreateMethod' ~}}
        {{ AggregateRoot.Name.CamelCase }} = {{ AggregateRoot.Name }}.Create(
    {{~for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
        {{~if parameter.IsComplex ~}}
            new {{ parameter.Type }}
            {
            {{~for nestedParameter in parameter.NestedParameters ~}}
                {{ nestedParameter.Name.PascalCase }} = command.{{ parameter.Name.PascalCase }}.{{ nestedParameter.Name.PascalCase }},
            {{~end~}}
            }{{if !for.last}},{{end}}
        {{~else~}}
            command.{{ parameter.Name.PascalCase }}{{if !for.last}},{{end}}
        {{~end~}}
    {{~end~}}
        );
{{~end~}}
{{~if AggregateRoot.CreateUseCase.Mechanism == 'Constructor' ~}}
        {{ AggregateRoot.Name.CamelCase }} = new {{ AggregateRoot.Name }}(
    {{~for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
        {{~if parameter.IsComplex ~}}
            new {{ parameter.Type }}
            {
            {{~for nestedParameter in parameter.NestedParameters ~}}
                {{ nestedParameter.Name.PascalCase }} = command.{{ parameter.Name.PascalCase }}.{{ nestedParameter.Name.PascalCase }},
            {{~end~}}
            }{{if !for.last}},{{end}}
        {{~else~}}
            command.{{ parameter.Name.PascalCase }}{{if !for.last}},{{end}}
        {{~end~}}
    {{~end~}}
        );
{{~end~}}
{{~if AggregateRoot.CreateUseCase.Mechanism == 'EmptyConstructor' ~}}
        {{ AggregateRoot.Name.CamelCase }} = new {{ AggregateRoot.Name }}();
{{~end~}}

        await _repository.AddAsync({{ AggregateRoot.Name.CamelCase }}, cancellationToken);
        
        _logger.LogInformation("Created new {{ AggregateRoot.Name }} with ID: {Id}", {{ AggregateRoot.Name.CamelCase }}.Id);

        return new Create{{ AggregateRoot.Name }}CommandResult
        {
            Id = {{ AggregateRoot.Name.CamelCase }}.Id
        };
    }
}

==================== CreateCommandResult ====================
namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Create;

/// <summary>
/// Represents the result of creating a new {{ AggregateRoot.Name }}.
/// </summary>
public sealed class Create{{ AggregateRoot.Name }}CommandResult
{
    /// <summary>
    /// Gets the unique identifier of the created {{ AggregateRoot.Name }}.
    /// </summary>
    public required {{ AggregateRoot.IdType }} Id { get; init; }
}

==================== CreateCommandValidator ====================
using LiteBus.Commands.Abstractions;
using {{ DomainProject.Namespace }};
using {{ DomainProject.Namespace }}.{{ AggregateRoot.Name.Plural }};

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Create;

public class Create{{ AggregateRoot.Name }}CommandValidator : ICommandPreHandler<Create{{ AggregateRoot.Name }}Command>
{
    public Task PreHandleAsync(Create{{ AggregateRoot.Name }}Command command, CancellationToken cancellationToken = default)
    {
        // TODO: Implement validation logic here
        // Example:
        // if (string.IsNullOrWhiteSpace(command.SomeProperty))
        //     throw new ValidationException("SomeProperty cannot be empty.");

        return Task.CompletedTask;
    }
}

==================== CreateRequestModel ====================
using System.ComponentModel.DataAnnotations;

namespace {{ WebApiProject.Namespace }}.Models.{{ AggregateRoot.Name.Plural }}.Create;

/// <summary>
/// Represents a request to create a new {{ AggregateRoot.Name }}.
/// </summary>
public class Create{{ AggregateRoot.Name }}Request
{
{{~ for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
    /// <summary>
    /// Gets or sets the {{ parameter.Name.Humanize }}.
    /// </summary>
    {{~ if parameter.IsRequired ~}}
    [Required]
    {{~ end ~}}
    public {{ if parameter.IsComplex }}{{ parameter.Name.PascalCase }}RequestModel{{ else }}{{ parameter.Type }}{{ end }}{{ if !parameter.IsRequired }}?{{ end }} {{ parameter.Name.PascalCase }} { get; set; }{{ if parameter.IsRequired }} = default!;{{ end }}

{{~ end ~}}
}

{{~ for parameter in AggregateRoot.CreateUseCase.Parameters ~}}
{{~ if parameter.IsComplex ~}}
/// <summary>
/// Represents the {{ parameter.Name.Humanize }} model for creating a {{ AggregateRoot.Name }}.
/// </summary>
public class {{ parameter.Name.PascalCase }}RequestModel
{
    {{~ for nestedParameter in parameter.NestedParameters ~}}
    /// <summary>
    /// Gets or sets the {{ nestedParameter.Name.Humanize }}.
    /// </summary>
    {{~ if nestedParameter.IsRequired ~}}
    [Required]
    {{~ end ~}}
    public {{ nestedParameter.Type }}{{ if !nestedParameter.IsRequired }}?{{ end }} {{ nestedParameter.Name.PascalCase }} { get; set; }{{ if nestedParameter.IsRequired }} = default!;{{ end }}

    {{~ end ~}}
}

{{~ end ~}}
{{~ end ~}}

/// <summary>
/// Represents the response after creating a new {{ AggregateRoot.Name }}.
/// </summary>
public class Create{{ AggregateRoot.Name }}Response
{
    /// <summary>
    /// Gets or sets the unique identifier of the created {{ AggregateRoot.Name }}.
    /// </summary>
    public required {{ AggregateRoot.IdType }} Id { get; set; }
}

==================== GetAllQuery ====================
using System.Collections.Generic;
using LiteBus.Queries.Abstractions;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Shared;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetAll;

/// <summary>
/// Represents a query to retrieve all {{ AggregateRoot.Name.Plural }}.
/// </summary>
public class GetAll{{ AggregateRoot.Name.Plural }}Query : IStreamQuery<{{ AggregateRoot.Name }}QueryResult>
{
    // This query doesn't require any parameters
}

==================== GetAllQueryHandler ====================
using System.Collections.Generic;
using System.Linq;
using System.Threading;
using System.Threading.Tasks;
using LiteBus.Queries.Abstractions;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Shared;
using {{ DomainProject.Namespace }};
using {{ DomainProject.Namespace }}.{{ AggregateRoot.Name.Plural }};
using Microsoft.Extensions.Logging;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetAll;

/// <summary>
/// Handles the retrieval of all {{ AggregateRoot.Name.Plural }}.
/// </summary>
public class GetAll{{ AggregateRoot.Name.Plural }}QueryHandler : IStreamQueryHandler<GetAll{{ AggregateRoot.Name.Plural }}Query, {{ AggregateRoot.Name }}QueryResult>
{
    private readonly {{ if Options.UseGenericRepository }}IRepository<{{ AggregateRoot.Name }}>{{ else }}I{{ AggregateRoot.Name }}Repository{{ end }} _repository;
    private readonly ILogger<GetAll{{ AggregateRoot.Name.Plural }}QueryHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="GetAll{{ AggregateRoot.Name.Plural }}QueryHandler"/> class.
    /// </summary>
    /// <param name="repository">The repository used to retrieve the {{ AggregateRoot.Name.Plural }}.</param>
    /// <param name="logger">The logger used for logging.</param>
    public GetAll{{ AggregateRoot.Name.Plural }}QueryHandler(
        {{ if Options.UseGenericRepository }}IRepository<{{ AggregateRoot.Name }}>{{ else }}I{{ AggregateRoot.Name }}Repository{{ end }} repository,
        ILogger<GetAll{{ AggregateRoot.Name.Plural }}QueryHandler> logger)
    {
        _repository = repository;
        _logger = logger;
    }

    /// <summary>
    /// Handles the GetAll{{ AggregateRoot.Name.Plural }}Query and returns the corresponding collection of {{ AggregateRoot.Name }}QueryResult.
    /// </summary>
    /// <param name="query">The query to retrieve all {{ AggregateRoot.Name.Plural }}.</param>
    /// <param name="cancellationToken">A token to cancel the operation.</param>
    /// <returns>An IAsyncEnumerable representing the asynchronous stream of {{ AggregateRoot.Name }}QueryResult.</returns>
    public IAsyncEnumerable<{{ AggregateRoot.Name }}QueryResult> StreamAsync(GetAll{{ AggregateRoot.Name.Plural }}Query query, CancellationToken cancellationToken = default)
    {
        _logger.LogInformation("Retrieving all {{ AggregateRoot.Name.Plural }}");

        return _repository.GetAllAsync(cancellationToken).Select(entity => new {{ AggregateRoot.Name }}QueryResult
        {
            Id = entity.Id,
            {{~ for property in AggregateRoot.Properties ~}}
            {{~ if property.Name.Original != "Id" ~}}
            {{ property.Name.PascalCase }} = {{ if property.IsComplex }}new {{ property.Name.PascalCase }}QueryResult
            {
                {{~ for nestedProperty in property.NestedProperties ~}}
                {{ nestedProperty.Name.PascalCase }} = entity.{{ property.Name.PascalCase }}.{{ nestedProperty.Name.PascalCase }},
                {{~ end ~}}
            }{{ else }}entity.{{ property.Name.PascalCase }}{{ end }},
            {{~ end ~}}
            {{~ end ~}}
        });
    }
}

==================== GetAllQueryValidator ====================
using LiteBus.Queries.Abstractions;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetAll;

public class GetAll{{ AggregateRoot.Name.Plural }}QueryValidator : IQueryPreHandler<GetAll{{ AggregateRoot.Name.Plural }}Query>
{
    public Task PreHandleAsync(GetAll{{ AggregateRoot.Name.Plural }}Query query, CancellationToken cancellationToken = default)
    {
        // TODO: Implement validation logic here if needed
        // Example:
        // if (query.PageSize.HasValue && query.PageSize.Value <= 0)
        //     throw new ValidationException("Page size must be greater than zero.");

        return Task.CompletedTask;
    }
}

==================== GetByIdQuery ====================
using System;
using LiteBus.Queries.Abstractions;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Shared;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetById;

/// <summary>
/// Represents a query to retrieve a {{ AggregateRoot.Name }} by its identifier.
/// </summary>
public class Get{{ AggregateRoot.Name }}ByIdQuery : IQuery<{{ AggregateRoot.Name }}QueryResult>
{
    /// <summary>
    /// Gets or sets the unique identifier of the {{ AggregateRoot.Name }} to retrieve.
    /// </summary>
    public required {{ AggregateRoot.IdType }} Id { get; init; }
}

==================== GetByIdQueryHandler ====================
using System;
using System.Threading;
using System.Threading.Tasks;
using LiteBus.Queries.Abstractions;
using {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Shared;
using {{ DomainProject.Namespace }}.{{ AggregateRoot.Name.Plural }};
using {{ DomainProject.Namespace }};
using Microsoft.Extensions.Logging;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetById;

/// <summary>
/// Handles the retrieval of a {{ AggregateRoot.Name }} by its identifier.
/// </summary>
public class Get{{ AggregateRoot.Name }}ByIdQueryHandler : IQueryHandler<Get{{ AggregateRoot.Name }}ByIdQuery, {{ AggregateRoot.Name }}QueryResult>
{
    private readonly {{ if Options.UseGenericRepository }}IRepository<{{ AggregateRoot.Name }}>{{ else }}I{{ AggregateRoot.Name }}Repository{{ end }} _repository;
    private readonly ILogger<Get{{ AggregateRoot.Name }}ByIdQueryHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="Get{{ AggregateRoot.Name }}ByIdQueryHandler"/> class.
    /// </summary>
    /// <param name="repository">The repository used to retrieve the {{ AggregateRoot.Name }}.</param>
    /// <param name="logger">The logger used for logging.</param>
    public Get{{ AggregateRoot.Name }}ByIdQueryHandler(
        {{ if Options.UseGenericRepository }}IRepository<{{ AggregateRoot.Name }}>{{ else }}I{{ AggregateRoot.Name }}Repository{{ end }} repository,
        ILogger<Get{{ AggregateRoot.Name }}ByIdQueryHandler> logger)
    {
        _repository = repository;
        _logger = logger;
    }

    /// <summary>
    /// Handles the Get{{ AggregateRoot.Name }}ByIdQuery and returns the corresponding {{ AggregateRoot.Name }}QueryResult.
    /// </summary>
    /// <param name="query">The query containing the identifier of the {{ AggregateRoot.Name }} to retrieve.</param>
    /// <param name="cancellationToken">A token to cancel the operation.</param>
    /// <returns>A task representing the asynchronous operation, containing the {{ AggregateRoot.Name }}QueryResult.</returns>
    public async Task<{{ AggregateRoot.Name }}QueryResult> HandleAsync(Get{{ AggregateRoot.Name }}ByIdQuery query, CancellationToken cancellationToken = default)
    {
        _logger.LogInformation("Retrieving {{ AggregateRoot.Name }} with ID: {Id}", query.Id);

        var entity = await _repository.GetByIdAsync(query.Id, cancellationToken);

        _logger.LogInformation("Successfully retrieved {{ AggregateRoot.Name }} with ID: {Id}", query.Id);

        return new {{ AggregateRoot.Name }}QueryResult
        {
            Id = entity.Id,
            {{ for property in AggregateRoot.Properties }}
            {{ if property.Name.Original != "Id" }}
            {{ property.Name.PascalCase }} = {{ if property.IsComplex }}new {{ property.Name.PascalCase }}QueryResult
            {
                {{ for nestedProperty in property.NestedProperties }}
                {{ nestedProperty.Name.PascalCase }} = entity.{{ property.Name.PascalCase }}.{{ nestedProperty.Name.PascalCase }},
                {{ end }}
            }{{ else }}entity.{{ property.Name.PascalCase }}{{ end }},
            {{ end }}
            {{ end }}
        };
    }
}

==================== GetByIdQueryValidator ====================
using LiteBus.Queries.Abstractions;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.GetById;

/// <summary>
/// Validates the Get{{ AggregateRoot.Name }}ByIdQuery before it is handled.
/// </summary>
public class Get{{ AggregateRoot.Name }}ByIdQueryValidator : IQueryPreHandler<Get{{ AggregateRoot.Name }}ByIdQuery>
{
    /// <summary>
    /// Validates the Get{{ AggregateRoot.Name }}ByIdQuery.
    /// </summary>
    /// <param name="query">The query to validate.</param>
    /// <param name="cancellationToken">The cancellation token.</param>
    public Task PreHandleAsync(Get{{ AggregateRoot.Name }}ByIdQuery query, CancellationToken cancellationToken = default)
    {
        // TODO: Implement validation logic here
        // Example:
        // if (query.Id == default)
        //     throw new ValidationException("Id must have a valid value.");

        return Task.CompletedTask;
    }
}

==================== SharedQueryResult ====================
using System;
using System.Collections.Generic;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.Shared;

/// <summary>
/// Represents the query result for {{ AggregateRoot.Name }} operations.
/// </summary>
public class {{ AggregateRoot.Name }}QueryResult
{
    /// <summary>
    /// Gets the unique identifier of the {{ AggregateRoot.Name }}.
    /// </summary>
    public required {{ AggregateRoot.IdType }} Id { get; init; }

    {{ for property in AggregateRoot.Properties }}
    {{ if property.Name.Original != "Id" }}
    /// <summary>
    /// Gets the {{ property.Name.Humanize }} of the {{ AggregateRoot.Name }}.
    /// </summary>
    {{ if property.IsRequired }}
    public required {{ property.Type }} {{ property.Name.PascalCase }} { get; init; }
    {{ else }}
    public {{ property.Type }}? {{ property.Name.PascalCase }} { get; init; }
    {{ end }}
    {{ end }}
    {{ end }}
}

{{ for property in AggregateRoot.Properties }}
{{ if property.IsComplex }}
/// <summary>
/// Represents the {{ property.Name.Humanize }} of a {{ AggregateRoot.Name }}.
/// </summary>
public class {{ property.Name.PascalCase }}QueryResult
{
    {{ for nestedProperty in property.NestedProperties }}
    /// <summary>
    /// Gets the {{ nestedProperty.Name.Humanize }} of the {{ property.Name.Humanize }}.
    /// </summary>
    {{ if nestedProperty.IsRequired }}
    public required {{ nestedProperty.Type }} {{ nestedProperty.Name.PascalCase }} { get; init; }
    {{ else }}
    public {{ nestedProperty.Type }}? {{ nestedProperty.Name.PascalCase }} { get; init; }
    {{ end }}
    {{ end }}
}
{{ end }}
{{ end }}

==================== SharedResponseModel ====================
using System;
using System.Collections.Generic;

namespace {{ WebApiProject.Namespace }}.Models.{{ AggregateRoot.Name.Plural }}.Shared;

/// <summary>
/// Represents the response model for {{ AggregateRoot.Name }} operations.
/// </summary>
public class {{ AggregateRoot.Name }}ResponseModel
{
    /// <summary>
    /// Gets or initializes the unique identifier of the {{ AggregateRoot.Name }}.
    /// </summary>
    public required {{ AggregateRoot.IdType }} Id { get; init; }

    {{~ for property in AggregateRoot.Properties ~}}
    {{~ if property.Name.Original != "Id" ~}}
    /// <summary>
    /// Gets or initializes the {{ property.Name.Humanize }} of the {{ AggregateRoot.Name }}.
    /// </summary>
    public {{ if !property.IsRequired }}{{ property.Type }}?{{ else }}required {{ property.Type }}{{ end }} {{ property.Name.PascalCase }} { get; init; }
    {{~ end ~}}
    {{~ end ~}}
}

{{~ for property in AggregateRoot.Properties ~}}
{{~ if property.IsComplex ~}}
/// <summary>
/// Represents the {{ property.Name.Humanize }} of a {{ AggregateRoot.Name }}.
/// </summary>
public class {{ property.Name.PascalCase }}ResponseModel
{
    {{~ for nestedProperty in property.NestedProperties ~}}
    /// <summary>
    /// Gets or initializes the {{ nestedProperty.Name.Humanize }} of the {{ property.Name.Humanize }}.
    /// </summary>
    public {{ if !nestedProperty.IsRequired }}{{ nestedProperty.Type }}?{{ else }}required {{ nestedProperty.Type }}{{ end }} {{ nestedProperty.Name.PascalCase }} { get; init; }
    {{~ end ~}}
}
{{~ end ~}}
{{~ end ~}}

==================== UseCaseCommand ====================
using LiteBus.Commands.Abstractions;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.{{ UseCase.Name }};

/// <summary>
/// Represents a command to {{ UseCase.Name.Humanize }} a {{ AggregateRoot.Name }}.
/// </summary>
public sealed class {{ UseCase.Name }}{{ AggregateRoot.Name }}Command : ICommand
{
    /// <summary>
    /// Gets or initializes the unique identifier of the {{ AggregateRoot.Name }}.
    /// </summary>
    public required {{ AggregateRoot.IdType }} Id { get; init; }

    {{~ for parameter in UseCase.Parameters ~}}
    /// <summary>
    /// Gets or initializes the {{ parameter.Name.Humanize }}.
    /// </summary>
    public {{ if parameter.IsComplex }}{{ parameter.Name.PascalCase }}CommandModel{{ else }}{{ parameter.Type }}{{ end }}{{ if !parameter.IsRequired }}?{{ end }} {{ parameter.Name.PascalCase }} { get; init; }{{ if parameter.IsRequired }} = default!;{{ end }}

    {{~ end ~}}
}

{{~ for parameter in UseCase.Parameters ~}}
{{~ if parameter.IsComplex ~}}
/// <summary>
/// Represents the {{ parameter.Name.Humanize }} model for the {{ UseCase.Name.Humanize }} command on {{ AggregateRoot.Name }}.
/// </summary>
public sealed class {{ parameter.Name.PascalCase }}CommandModel
{
    {{~ for nestedParameter in parameter.NestedParameters ~}}
    /// <summary>
    /// Gets or initializes the {{ nestedParameter.Name.Humanize }}.
    /// </summary>
    public {{ nestedParameter.Type }}{{ if !nestedParameter.IsRequired }}?{{ end }} {{ nestedParameter.Name.PascalCase }} { get; init; }{{ if nestedParameter.IsRequired }} = default!;{{ end }}

    {{~ end ~}}
}

{{~ end ~}}
{{~ end ~}}

==================== UseCaseCommandHandler ====================
using {{ DomainProject.Namespace }};
using {{ DomainProject.Namespace }}.{{ AggregateRoot.Name.Plural }};
using LiteBus.Commands.Abstractions;
using Microsoft.Extensions.Logging;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.{{ UseCase.Name }};

/// <summary>
/// Handles the {{ UseCase.Name }} command for {{ AggregateRoot.Name }}.
/// </summary>
public class {{ UseCase.Name }}{{ AggregateRoot.Name }}CommandHandler : ICommandHandler<{{ UseCase.Name }}{{ AggregateRoot.Name }}Command>
{
    {{~ if Options.UseGenericRepository ~}}
    private readonly IRepository<{{ AggregateRoot.Name }}> _repository;
    {{~ else ~}}
    private readonly I{{ AggregateRoot.Name }}Repository _repository;
    {{~ end ~}}
    private readonly ILogger<{{ UseCase.Name }}{{ AggregateRoot.Name }}CommandHandler> _logger;

    /// <summary>
    /// Initializes a new instance of the <see cref="{{ UseCase.Name }}{{ AggregateRoot.Name }}CommandHandler"/> class.
    /// </summary>
    /// <param name="repository">The repository for {{ AggregateRoot.Name }} entities.</param>
    /// <param name="logger">The logger.</param>
    public {{ UseCase.Name }}{{ AggregateRoot.Name }}CommandHandler(
        {{~ if Options.UseGenericRepository ~}}
        IRepository<{{ AggregateRoot.Name }}> repository,
        {{~ else ~}}
        I{{ AggregateRoot.Name }}Repository repository,
        {{~ end ~}}
        ILogger<{{ UseCase.Name }}{{ AggregateRoot.Name }}CommandHandler> logger)
    {
        _repository = repository;
        _logger = logger;
    }

    /// <summary>
    /// Handles the {{ UseCase.Name }} command for {{ AggregateRoot.Name }}.
    /// </summary>
    /// <param name="command">The command to handle.</param>
    /// <param name="cancellationToken">The cancellation token.</param>
    public async Task HandleAsync({{ UseCase.Name }}{{ AggregateRoot.Name }}Command command, CancellationToken cancellationToken = default)
    {
        _logger.LogInformation("Executing {{ UseCase.Name }} command for {{ AggregateRoot.Name }} with ID: {Id}", command.Id);

        var {{ AggregateRoot.Name.CamelCase }} = await _repository.GetAsync(command.Id, cancellationToken);

        if ({{ AggregateRoot.Name.CamelCase }} == null)
        {
            _logger.LogWarning("{{ AggregateRoot.Name }} with ID: {Id} not found", command.Id);
            throw new NotFoundException($"{{ AggregateRoot.Name }} with ID {command.Id} not found");
        }

        {{ AggregateRoot.Name.CamelCase }}.{{ UseCase.Name }}(
            {{~ for parameter in UseCase.Parameters ~}}
            {{~ if parameter.IsComplex ~}}
            new {{ parameter.Type }}
            {
                {{~ for nestedParameter in parameter.NestedParameters ~}}
                {{ nestedParameter.Name.PascalCase }} = command.{{ parameter.Name.PascalCase }}.{{ nestedParameter.Name.PascalCase }},
                {{~ end ~}}
            }{{~ if !for.last ~}},{{~ end ~}}
            {{~ else ~}}
            command.{{ parameter.Name.PascalCase }}{{~ if !for.last ~}},{{~ end ~}}
            {{~ end ~}}
            {{~ end ~}}
        );

        await _repository.UpdateAsync({{ AggregateRoot.Name.CamelCase }}, cancellationToken);
        
        _logger.LogInformation("Successfully executed {{ UseCase.Name }} command for {{ AggregateRoot.Name }} with ID: {Id}", command.Id);
    }
}

==================== UseCaseCommandValidator ====================
using LiteBus.Commands.Abstractions;

namespace {{ ApplicationProject.Namespace }}.{{ AggregateRoot.Name.Plural }}.{{ UseCase.Name }};

public class {{ UseCase.Name }}{{ AggregateRoot.Name }}CommandValidator : ICommandPreHandler<{{ UseCase.Name }}{{ AggregateRoot.Name }}Command>
{
    public Task PreHandleAsync({{ UseCase.Name }}{{ AggregateRoot.Name }}Command command, CancellationToken cancellationToken = default)
    {
        // TODO: Implement validation logic here

        return Task.CompletedTask;
    }
}

==================== UseCaseRequestModel ====================
using System;
using System.ComponentModel.DataAnnotations;

namespace {{ WebApiProject.Namespace }}.Models.{{ AggregateRoot.Name.Plural }}.{{ UseCase.Name }};

/// <summary>
/// Represents a request for the {{ UseCase.Name.Humanize }} operation on {{ AggregateRoot.Name }}.
/// </summary>
public class {{ UseCase.Name }}{{ AggregateRoot.Name }}Request
{
    {{~ for parameter in UseCase.Parameters ~}}
    /// <summary>
    /// Gets or sets the {{ parameter.Name.Humanize }}.
    /// </summary>
    {{~ if parameter.IsRequired ~}}
    [Required]
    {{~ end ~}}
    public {{ if parameter.IsComplex }}{{ parameter.Name.PascalCase }}RequestModel{{ else }}{{ parameter.Type }}{{ end }}{{ if !parameter.IsRequired }}?{{ end }} {{ parameter.Name.PascalCase }} { get; set; }{{ if parameter.IsRequired }} = default!;{{ end }}

    {{~ end ~}}
}

{{~ for parameter in UseCase.Parameters ~}}
{{~ if parameter.IsComplex ~}}
/// <summary>
/// Represents the {{ parameter.Name.Humanize }} model for the {{ UseCase.Name.Humanize }} operation on {{ AggregateRoot.Name }}.
/// </summary>
public class {{ parameter.Name.PascalCase }}RequestModel
{
    {{~ for nestedParameter in parameter.NestedParameters ~}}
    /// <summary>
    /// Gets or sets the {{ nestedParameter.Name.Humanize }}.
    /// </summary>
    {{~ if nestedParameter.IsRequired ~}}
    [Required]
    {{~ end ~}}
    public {{ nestedParameter.Type }}{{ if !nestedParameter.IsRequired }}?{{ end }} {{ nestedParameter.Name.PascalCase }} { get; set; }{{ if nestedParameter.IsRequired }} = default!;{{ end }}

    {{~ end ~}}
}

{{~ end ~}}
{{~ end ~}}
